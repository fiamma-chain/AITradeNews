# Redis ä½™é¢å†å²å­˜å‚¨ - å®‰è£…æŒ‡å— ğŸ“¦

## âœ… å·²å®Œæˆçš„å®ç°

### 1. ä»£ç å®ç° âœ…
- âœ… Redisç®¡ç†å™¨ (`utils/redis_manager.py`)
- âœ… åç«¯ä¿å­˜å¿«ç…§é€»è¾‘ (`consensus_arena_multiplatform.py`)
- âœ… APIç«¯ç‚¹ `/api/balance_history`
- âœ… å‰ç«¯åŠ è½½å†å²æ•°æ® (`web/index.html`)
- âœ… é…ç½®é¡¹ (`config/settings.py`)

### 2. Pythonåº“ âœ…
- âœ… `redis==5.0.1` å·²å®‰è£…

### 3. ä¼˜é›…é™çº§ âœ…
- âœ… Redisæœªè¿æ¥æ—¶ç³»ç»Ÿä»æ­£å¸¸è¿è¡Œ
- âœ… åªæ˜¾ç¤ºè­¦å‘Šï¼Œä¸å½±å“äº¤æ˜“åŠŸèƒ½

## âš ï¸ å½“å‰çŠ¶æ€

**RedisæœåŠ¡å™¨**: âŒ æœªå®‰è£…/æœªè¿è¡Œ

ç³»ç»Ÿå¯åŠ¨æ—¥å¿—æ˜¾ç¤ºï¼š
```
âŒ Redis è¿æ¥å¤±è´¥: Error 61 connecting to localhost:6379. Connection refused.
```

**å½±å“**: 
- âŒ é¡µé¢åˆ·æ–°åèµ°åŠ¿æ•°æ®ä»ä¼šæ¸…é›¶
- âœ… å…¶ä»–åŠŸèƒ½æ­£å¸¸ä½¿ç”¨

## ğŸš€ å¯ç”¨RedisåŠŸèƒ½

### æ–¹å¼1: ä½¿ç”¨Homebrew (æ¨è)

#### 1. å®‰è£…Homebrew (å¦‚æœªå®‰è£…)
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

#### 2. å®‰è£…Redis
```bash
brew install redis
```

#### 3. å¯åŠ¨Redis
```bash
# åå°è¿è¡Œ
brew services start redis

# æˆ–å‰å°è¿è¡Œ (è°ƒè¯•ç”¨)
redis-server
```

#### 4. éªŒè¯å®‰è£…
```bash
redis-cli ping
# åº”è¿”å›: PONG
```

#### 5. é‡å¯äº¤æ˜“ç³»ç»Ÿ
ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è¿æ¥Redisï¼Œæ—¥å¿—æ˜¾ç¤ºï¼š
```
âœ… Redis è¿æ¥æˆåŠŸ: localhost:6379
```

### æ–¹å¼2: ä½¿ç”¨Docker

#### 1. å®‰è£…Docker Desktop
ä» https://www.docker.com/products/docker-desktop ä¸‹è½½å®‰è£…

#### 2. è¿è¡ŒRediså®¹å™¨
```bash
docker run -d \
  --name redis \
  -p 6379:6379 \
  redis:latest
```

#### 3. éªŒè¯è¿è¡Œ
```bash
docker ps | grep redis
```

#### 4. é‡å¯äº¤æ˜“ç³»ç»Ÿ
ç³»ç»Ÿä¼šè‡ªåŠ¨è¿æ¥åˆ°Redis

### æ–¹å¼3: æ‰‹åŠ¨ç¼–è¯‘å®‰è£…

#### 1. ä¸‹è½½Redis
```bash
cd /tmp
curl -O https://download.redis.io/redis-stable.tar.gz
tar xzf redis-stable.tar.gz
cd redis-stable
```

#### 2. ç¼–è¯‘å®‰è£…
```bash
make
sudo make install
```

#### 3. å¯åŠ¨Redis
```bash
redis-server --daemonize yes
```

## ğŸ“Š é…ç½®é€‰é¡¹

### é»˜è®¤é…ç½® (`.env`)
```env
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
BALANCE_HISTORY_TTL=604800  # 7å¤©
```

### è‡ªå®šä¹‰é…ç½®
å¦‚æœRedisä¸åœ¨æœ¬åœ°æˆ–ä½¿ç”¨äº†å¯†ç ï¼š
```env
REDIS_HOST=your-redis-host.com
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=your-password
```

## ğŸ” éªŒè¯åŠŸèƒ½

### 1. æ£€æŸ¥Redisè¿æ¥
```bash
tail -100 /tmp/ai_trading.log | grep Redis
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… Redis è¿æ¥æˆåŠŸ: localhost:6379
```

### 2. æ£€æŸ¥æ•°æ®ä¿å­˜
ç­‰å¾…ä¸€ä¸ªå†³ç­–å‘¨æœŸï¼ˆ5åˆ†é’Ÿï¼‰åï¼š
```bash
redis-cli LLEN balance_history
```

åº”è¯¥è¿”å›ä¸€ä¸ªæ•°å­—ï¼ˆå¦‚ï¼š1, 2, 3...ï¼‰

### 3. æŸ¥çœ‹æœ€æ–°æ•°æ®
```bash
redis-cli LRANGE balance_history 0 0
```

### 4. æµ‹è¯•API
```bash
curl http://localhost:46000/api/balance_history | python3 -m json.tool
```

### 5. æµ‹è¯•å‰ç«¯
1. æ‰“å¼€ http://localhost:46000
2. ç­‰å¾…æ”¶é›†ä¸€äº›æ•°æ®ç‚¹ï¼ˆçº¦10åˆ†é’Ÿï¼‰
3. åˆ·æ–°é¡µé¢ (Cmd+R)
4. âœ… èµ°åŠ¿å›¾åº”è¯¥æ˜¾ç¤ºå†å²æ•°æ®ï¼Œä¸å†æ¸…é›¶

## ğŸ¯ åŠŸèƒ½å¯¹æ¯”

### æ— Redisï¼ˆå½“å‰çŠ¶æ€ï¼‰
```
é¡µé¢åˆ·æ–°å‰: æœ‰10ä¸ªæ•°æ®ç‚¹
      â†“
   åˆ·æ–°é¡µé¢
      â†“
é¡µé¢åˆ·æ–°å: æ•°æ®æ¸…é›¶ï¼Œä»0å¼€å§‹
```

### æœ‰Redisï¼ˆå¯ç”¨åï¼‰
```
é¡µé¢åˆ·æ–°å‰: æœ‰10ä¸ªæ•°æ®ç‚¹
      â†“
   åˆ·æ–°é¡µé¢
      â†“
é¡µé¢åˆ·æ–°å: ä»RedisåŠ è½½100ä¸ªå†å²ç‚¹
            + ç»§ç»­å®æ—¶æ›´æ–°
```

## ğŸ“ˆ æ•°æ®ä¿å­˜è§„åˆ™

### ä¿å­˜æ—¶æœº
- æ¯5åˆ†é’Ÿå†³ç­–å‘¨æœŸç»“æŸå
- è‡ªåŠ¨ä¿å­˜4ä¸ªè´¦æˆ·çš„ä½™é¢å¿«ç…§

### ä¿å­˜å†…å®¹
```json
{
  "timestamp": "2025-10-23T00:30:00",
  "accounts": [
    {
      "group": "Alphaç»„",
      "platform": "Alphaç»„-Hyperliquid",
      "balance": 250.42,
      "pnl": 0.42,
      "roi": 0.17,
      "total_trades": 5
    }
  ]
}
```

### æ•°æ®é™åˆ¶
- **æœ€å¤šä¿ç•™**: 1000æ¡è®°å½•
- **æ—¶é—´è·¨åº¦**: çº¦83å°æ—¶
- **è‡ªåŠ¨è¿‡æœŸ**: 7å¤©ååˆ é™¤

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: Rediså®‰è£…åç³»ç»Ÿéœ€è¦é‡å¯å—ï¼Ÿ
**A**: ä¸éœ€è¦å®Œå…¨é‡å¯ï¼Œåªéœ€ï¼š
```bash
# åœæ­¢å½“å‰ç³»ç»Ÿ
lsof -ti:46000 | xargs kill -9

# é‡æ–°å¯åŠ¨
cd AIPredict
python3 consensus_arena_multiplatform.py
```

### Q2: Rediså´©æºƒä¼šå½±å“äº¤æ˜“å—ï¼Ÿ
**A**: ä¸ä¼šã€‚Redisåªç”¨äºå­˜å‚¨å†å²æ•°æ®ï¼Œä¸å½±å“å®æ—¶äº¤æ˜“ã€‚ç³»ç»Ÿä¼šæ£€æµ‹åˆ°Redisæ–­å¼€å¹¶ç»§ç»­è¿è¡Œã€‚

### Q3: æ•°æ®ä¼šå ç”¨å¤šå°‘å†…å­˜ï¼Ÿ
**A**: çº¦500KBï¼ˆ1000æ¡è®°å½• Ã— 500å­—èŠ‚ï¼‰

### Q4: å¯ä»¥æ¸…ç©ºå†å²æ•°æ®å—ï¼Ÿ
**A**: å¯ä»¥
```bash
redis-cli DEL balance_history
```

### Q5: Rediséœ€è¦é…ç½®æŒä¹…åŒ–å—ï¼Ÿ
**A**: å»ºè®®é…ç½®ï¼Œç¼–è¾‘`/usr/local/etc/redis.conf`:
```
save 900 1      # 15åˆ†é’Ÿå†…è‡³å°‘1ä¸ªkeyå˜åŒ–å°±ä¿å­˜
save 300 10     # 5åˆ†é’Ÿå†…è‡³å°‘10ä¸ªkeyå˜åŒ–å°±ä¿å­˜
save 60 10000   # 1åˆ†é’Ÿå†…è‡³å°‘10000ä¸ªkeyå˜åŒ–å°±ä¿å­˜
```

## ğŸ“ æ€»ç»“

### å½“å‰å®ç°çŠ¶æ€
- âœ… æ‰€æœ‰ä»£ç å·²å®ç°
- âœ… Pythonåº“å·²å®‰è£…
- âœ… ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- âŒ RedisæœåŠ¡å™¨æœªå®‰è£…

### å¯ç”¨æ­¥éª¤
1. å®‰è£…Redis (é€‰æ‹©ä¸Šè¿°ä¸‰ç§æ–¹å¼ä¹‹ä¸€)
2. å¯åŠ¨RedisæœåŠ¡
3. é‡å¯äº¤æ˜“ç³»ç»Ÿ
4. âœ… è‡ªåŠ¨å¯ç”¨å†å²æ•°æ®åŠŸèƒ½

### é¢„æœŸæ•ˆæœ
- é¡µé¢åˆ·æ–°ä¸ä¸¢å¤±æ•°æ®
- å®Œæ•´çš„æ”¶ç›Šèµ°åŠ¿å›¾
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---
*Redisä½™é¢å†å²å­˜å‚¨ - å®‰è£…æŒ‡å—* ğŸ“¦

**å»ºè®®**: å®‰è£…Redisåï¼Œç³»ç»Ÿçš„ç”¨æˆ·ä½“éªŒä¼šæ˜¾è‘—æå‡ï¼

