# 消息驱动交易 - 实战配置总结

## 🎯 **配置更新时间**
$(date '+%Y-%m-%d %H:%M:%S')

---

## ⚙️ **核心配置**

### **1. 交易平台**
```bash
ENABLED_PLATFORMS=hyperliquid    # ✅ 仅Hyperliquid
```

**原因**：
- Hyperliquid流动性更好
- 响应速度更快
- 滑点更小

---

### **2. 保证金策略（动态）**

#### **计算公式**
```python
# 信心度 -> 保证金比例
if confidence < 60%:
    margin_pct = 30%  # 最小30%
else:
    # 线性映射: 60% -> 30%, 100% -> 100%
    margin_pct = 30% + ((confidence - 60) / 40) × 70%

actual_margin = account_balance × margin_pct
```

#### **映射表**

| 信心度 | 保证金比例 | 账户余额=200U | 实际保证金 |
|--------|-----------|--------------|-----------|
| 60% | 30% | 200U | 60U |
| 65% | 39% | 200U | 78U |
| 70% | 48% | 200U | 95U |
| 75% | 56% | 200U | 113U |
| 80% | 65% | 200U | 130U |
| 85% | 74% | 200U | 148U |
| 90% | 83% | 200U | 165U |
| 95% | 91% | 200U | 183U |
| 100% | 100% | 200U | 200U |

**特点**：
- ✅ 信心度越高，使用的资金越多
- ✅ 最低30%，最高100%
- ✅ 自动风险控制

---

### **3. 杠杆策略（动态）**

#### **计算公式**
```python
# AI根据信心度决定杠杆（10-50倍）
# 建议映射:
leverage = 10 + ((confidence - 60) / 40) × 40
leverage = max(10, min(leverage, 50))
```

#### **映射表**

| 信心度 | 杠杆倍数 | 保证金比例 | 账户200U | 仓位价值 |
|--------|---------|-----------|---------|---------|
| 60% | 10x | 30% | 60U | 600U |
| 65% | 15x | 39% | 78U | 1,170U |
| 70% | 20x | 48% | 95U | 1,900U |
| 75% | 25x | 56% | 113U | 2,825U |
| 80% | 30x | 65% | 130U | 3,900U |
| 85% | 35x | 74% | 148U | 5,180U |
| 90% | 40x | 83% | 165U | 6,600U |
| 95% | 45x | 91% | 183U | 8,235U |
| 100% | 50x | 100% | 200U | 10,000U |

**特点**：
- ✅ 信心度越高，杠杆越大
- ✅ 范围10-50倍
- ⚠️ 高杠杆高风险

---

### **4. 止盈止损（固定）**

```python
STOP_LOSS = 1%    # 价格跌1%触发
TAKE_PROFIT = 5%  # 价格涨5%触发
```

#### **不同杠杆的盈亏效果**

| 杠杆 | 止损(价格-1%) | 止损(本金) | 止盈(价格+5%) | 止盈(本金) | 盈亏比 |
|------|--------------|-----------|--------------|-----------|--------|
| 10x | -1% | -10% | +5% | +50% | 5:1 ✅ |
| 20x | -1% | -20% | +5% | +100% | 5:1 ✅ |
| 30x | -1% | -30% | +5% | +150% | 5:1 ✅ |
| 40x | -1% | -40% | +5% | +200% | 5:1 ✅ |
| 50x | -1% | -50% | +5% | +250% | 5:1 ✅ |

**特点**：
- ✅ 盈亏比5:1非常优秀
- ✅ 止损快速，保护本金
- ⚠️ 高杠杆下，1%止损可能频繁触发

---

## 📊 **完整示例计算**

### **场景：BTC上币消息**

#### **假设**
- 账户余额：200 USDT
- AI信心度：80%
- BTC价格：$100,000
- 方向：做多

#### **参数计算**

```python
# 1. 保证金
margin_pct = 30% + ((80 - 60) / 40) × 70% = 65%
actual_margin = 200 × 0.65 = 130 USDT

# 2. 杠杆（AI决定，假设30x）
leverage = 30x

# 3. 仓位价值
position_value = 130 × 30 = 3,900 USDT

# 4. 交易数量
size = 3,900 / 100,000 = 0.039 BTC

# 5. 止盈止损
止损价格 = 100,000 × (1 - 0.01) = 99,000
止盈价格 = 100,000 × (1 + 0.05) = 105,000
```

#### **盈亏计算**

| 场景 | 价格变化 | 仓位盈亏 | 本金收益率 | 剩余资金 |
|------|---------|---------|-----------|---------|
| **开仓** | - | - | - | 200U |
| **止损触发** | -1% | -39U | -19.5% | 161U |
| **止盈触发** | +5% | +195U | +97.5% | 395U |

---

## 🎯 **AI配置**

### **使用的AI**
```bash
NEWS_TRADING_AIS=grok    # 仅Grok（1.7s响应）
```

### **AI提示词规则**
```
- Leverage: 60%→10x, 70%→20x, 80%→30x, 90%→40x, 100%→50x
- Margin: 60%→30% of balance, 80%→65%, 100%→100%
- Stop loss: 1% (fixed)
- Take profit: 5% (fixed)
- Only trade if confidence ≥ 60%
```

---

## ⚠️ **风险提示**

### **1. 高杠杆风险**
- 50x杠杆下，价格波动2%可能爆仓
- 建议监控账户风险率

### **2. 快速止损**
- 1%止损在高杠杆下可能频繁触发
- 观察市场波动性，必要时调整

### **3. 全仓风险**
- 100%信心度会使用全部账户余额
- 确保账户有充足资金

### **4. 消息可靠性**
- 并非所有上币消息都带来正收益
- 需要AI准确判断消息质量

---

## 📈 **预期表现**

### **不同信心度的风险收益**

| 信心度 | 保证金 | 杠杆 | 仓位 | 止损亏损 | 止盈盈利 | 风险评级 |
|--------|--------|------|------|---------|---------|---------|
| 60% | 30% | 10x | 小 | -3% | +15% | 低风险 |
| 70% | 48% | 20x | 中 | -10% | +48% | 中风险 |
| 80% | 65% | 30x | 大 | -19.5% | +97.5% | 高风险 |
| 90% | 83% | 40x | 很大 | -33% | +165% | 极高风险 |
| 100% | 100% | 50x | 全仓 | -50% | +250% | 极高风险 |

---

## 🚀 **启动前检查**

- [ ] 平台配置：`ENABLED_PLATFORMS=hyperliquid`
- [ ] AI配置：`NEWS_TRADING_AIS=grok`
- [ ] 消息交易已启用：`NEWS_TRADING_ENABLED=True`
- [ ] 常规交易已禁用
- [ ] Grok API密钥和私钥已配置
- [ ] 账户有充足余额（建议>200U）
- [ ] 理解高杠杆风险

---

## 📝 **配置文件位置**

| 配置类型 | 文件 | 说明 |
|---------|------|------|
| 保证金策略 | `news_trading/news_handler.py` (L191-208) | 动态计算 |
| 杠杆范围 | `news_trading/news_analyzer.py` (L267) | 10-50倍 |
| 止盈止损 | `news_trading/news_analyzer.py` (L269-270) | 1%/5% |
| AI提示词 | `news_trading/news_analyzer.py` (L100-119) | 规则说明 |
| 环境变量 | `.env` | 平台、AI选择 |

---

## 🔧 **如需调整配置**

### **调整止盈止损**
编辑 `news_trading/news_analyzer.py` L269-270:
```python
stop_loss = 0.01  # 改为其他值，如0.02 (2%)
take_profit = 0.05  # 改为其他值，如0.08 (8%)
```

### **调整杠杆范围**
编辑 `news_trading/news_analyzer.py` L267:
```python
leverage = max(10, min(leverage, 50))  # 改为其他范围
```

### **调整保证金比例**
编辑 `news_trading/news_handler.py` L191-199:
```python
# 当前: 60%->30%, 100%->100%
# 可改为: 60%->20%, 100%->80% (更保守)
margin_pct = 0.20 + ((confidence - 60) / 40) * 0.60
```

---

**配置完成！准备实战测试！** 🚀

